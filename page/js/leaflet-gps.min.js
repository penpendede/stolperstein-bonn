/* 
 * Leaflet Control GPS v1.5.0 - 2016-10-29 
 * 
 * Copyright 2016 Stefano Cudini 
 * stefano.cudini@gmail.com 
 * http://labs.easyblog.it/ 
 * 
 * Licensed under the MIT license. 
 * 
 * Demos: 
 * http://labs.easyblog.it/maps/leaflet-gps/ 
 * 
 * Source: 
 * git@github.com:stefanocudini/leaflet-gps.git 
 * 
 */
!function(a){if("function"==typeof define&&define.amd)define(["leaflet"],a);else if("undefined"!=typeof module)module.exports=a(require("leaflet"));else{if("undefined"==typeof window.L)throw"Leaflet must be loaded first";a(window.L)}}(function(a){return a.Control.Gps=a.Control.extend({includes:a.Mixin.Events,options:{autoActive:!1,autoCenter:!1,maxZoom:null,textErr:null,callErr:null,style:{radius:5,weight:2,color:"#c20",opacity:1,fillColor:"#f23",fillOpacity:1},marker:null,accuracy:!0,title:"Center map on your location",position:"topleft",transform:function(a){return a},setView:!1},initialize:function(b){b&&b.style&&(b.style=a.Util.extend({},this.options.style,b.style)),a.Util.setOptions(this,b),this._errorFunc=this.options.callErr||this.showAlert,this._isActive=!1,this._firstMoved=!1,this._currentLocation=null},onAdd:function(b){this._map=b;var c=a.DomUtil.create("div","leaflet-control-gps");return this._button=a.DomUtil.create("a","gps-button",c),this._button.href="#",this._button.title=this.options.title,a.DomEvent.on(this._button,"click",a.DomEvent.stop,this).on(this._button,"click",this._switchGps,this),this._alert=a.DomUtil.create("div","gps-alert",c),this._alert.style.display="none",this._gpsMarker=this.options.marker?this.options.marker:new a.CircleMarker([0,0],this.options.style),this._map.on("locationfound",this._drawGps,this).on("locationerror",this._errorGps,this),this.options.autoActive&&this.activate(),c},onRemove:function(a){this.deactivate()},_switchGps:function(){this._isActive?this.deactivate():this.activate()},getLocation:function(){return this._currentLocation},activate:function(){this._isActive=!0,this._map.addLayer(this._gpsMarker),this._map.locate({enableHighAccuracy:!0,watch:!0,setView:this.options.setView,maxZoom:this.options.maxZoom})},deactivate:function(){this._isActive=!1,this._firstMoved=!1,this._map.stopLocate(),a.DomUtil.removeClass(this._button,"active"),this._map.removeLayer(this._gpsMarker),this.fire("gps:disabled")},_drawGps:function(b){this._currentLocation=this.options.transform(b.latlng),this._gpsMarker.setLatLng(this._currentLocation),!this._isActive||this._firstMoved&&!this.options.autoCenter||this._moveTo(this._currentLocation),this.fire("gps:located",{latlng:this._currentLocation,marker:this._gpsMarker}),a.DomUtil.addClass(this._button,"active")},_moveTo:function(a){this._firstMoved=!0,this.options.maxZoom?this._map.setView(a,Math.min(this._map.getZoom(),this.options.maxZoom)):this._map.panTo(a)},_errorGps:function(a){this.deactivate(),this._errorFunc.call(this,this.options.textErr||a.message)},showAlert:function(a){this._alert.style.display="block",this._alert.innerHTML=a;var b=this;clearTimeout(this.timerAlert),this.timerAlert=setTimeout(function(){b._alert.style.display="none"},2e3)}}),a.Map.addInitHook(function(){this.options.gpsControl&&(this.gpsControl=a.control.gps(this.options.gpsControl),this.addControl(this.gpsControl))}),a.control.gps=function(b){return new a.Control.Gps(b)},a.Control.Gps});